#summary Formal definitions for deltas

= Introduction =
"Delta Algebra" is the name for a formalism of the concept of deltas used in PackageLibrary. The relation between this formalism and the practical deltas used in the Enough PackageLibrary is not well defined. This formalism was created mainly for amusement, but it may find future applications in (possibly automatic) formal verification of a system that uses the delta concept.

== Notation ==
 * Functions are in _italic_, e.g. _f_.
 * Sets are in *bold*, e.g. *V1*.
 * The empty set is {}.

= Invertible functions group =
== Basics ==
 * *V* is the set of all values.
 * Let _f_ be a function with the following properties:
   * _f: *V1* -> *V2*_, where *V1* and *V2* are subsets of *V*.
   * _f_ is *invertible*: There exists _f^-1^_ such that _f^-1^_(_f_(x)) = x for every x in *V1*.
     * By definition, we have _f^-1^_: *V2* -> *V1.
 * *Equality*:
   * Given the following:
     * _f_: *V1* -> *V2*, where *V1*, *V2* are subsets of *V*
     * _g_: *W1* -> *W2*, where *W1*, *W2* are subsets of *V*
     * _intersection_(*V1*, *W1*) = *X1* != {}
   * We define _f_ = _g_ _in *X1*_ iff for every x in *X1* _f_(x) = _g_(x).
   * If *V1* = *W1* ( = *X1*) then we say that _f_ = _g_ _totally_, or: _f_ and _g_ are totally equal, or: _f_ and _g_ are identical. In this case the two functions are indistinguishable.
 * We define F,,inv,, as the set of invertible functions (including _id_).
 * The *identity function* _id_: *V* -> *V* maps every value to itself. By definition _id_ = _id^-1^_.
   * *Theorem*: There is only one identity function in F,,inv,,.
      * *Proof*: If _f_: *V* -> *V* is an identity function, then _f_(x) = x for every x in *V* by definition. However, x = _id_(x) because we have already defined the identity function _id_. Therefore by definition _f_ = _id_ (totally) and they are the same function.

== Group ==
The set of invertible functions F,,inv,, with *composition* and *inversion* form a *group*.
 * *Composition*: (_f_ o _g_)[x] = _f_(_g_[x]). In our notation: _f_ o _g_ = _fg_.
   * *Associativity*: _(fg)h_ = _f(gh)_ because _(fg)h_[x] = _f_(_g_( _h_[x] )) = _f_( _g_(_h_[x])) = _f(gh)_[x] for every x in the domain of _h_.
     * By induction, any finite composition of functions is associative, and we can always simply write: _f,,1,,f,,2,,f,,3,,f,,4,,...f,,n,,_ without parenthesis.
 * *Inversion*: by definition every function in the set of invertible function has an inverse. Therefore we may define the _inverse operation_ notated by ^-1^.
   * *Theorem i1*: _Uniqueness of inverse_. 


 * *D* is the set of all deltas.
 * *A* is a set of deltas, called the *atomic set*. Every delta in *A* is called an *atomic delta*.

 * *Applicable*: A delta _d_ is *applicable* to a value _v_ if and only if there is defined a function _A,,d,V1,,_ where _v_ belongs to *V1*.
 * *Domain of a delta*: the domain of a delta _d_ is the set of all _v_'s such that _d_ is applicable to _v_. 
 * The *image of a delta* _d_, is the set of all values _v_ such that applying _d_ to a value in _d_'s domain yields _v_. (It is the image of _A,,d,V1,,_.)
 * The *Common domain* of a set of deltas *D1* (a subset of *D*), is the intersection of all the domains of each _d_ in *D1*.

 * *Equality* (=): For every pair of deltas _d,,1,,_, _d,,2,,_, it is said that _d,,1,,_ = _d,,2,,_ _in *V1*_ (they are _*equal* in *V1*_) if and only if for evey _v_ in *V1*: _A,,d1,V1,,_(_v_) = _A,,d2,V1,,_(_v_) (that is, if the delta apply functions have equal values for a given _v_).
    * *Total equality*: If _d,,1,,_ = _d,,2,,_ in the domain of _d,,1,,_, and the domain of _d,,1,,_ is also the domain of _d,,2,,_, then _d,,1,,_ and _d,,2,,_ are *totally equal*, that is - they are indistinguishable and can be regarded as the same delta.

 * *Addition* (+):
    * Assume a pair of deltas _d,,1,,_, _d,,2,,_ such that the range of _A,,d1,V1,,_ is a subset of the domain of _d,,2,,_ (that is: _d,,2,,_ is applicable to _A,,d1,V1,,_(_v_) for all _v_ in *V1*. Or in other words, _A,,d1,V1,,_ is at least _into_ the domain of _d,,2,,_).
    * Then the *addition* _d,,1,,_+_d,,2,,_ is a delta, that is defined by: _A_,,d1+d2,V1,,(_v_) = _A,,d2,V2,,_(_A,,d1,V1,,_(_v_)). Another name for addition is *combination*. As a formal notation, the left form is the _combined_ form, and the right side of the equation is the _canonical_ form. That is, if _d_ = _d,,1,,_ + _d,,2,,_ then _d_ is combined, _d,,1,,_ + _d,,2,,_ is canonical.
    * *Theorem a1*: _Associativity of addition_: _d,,1,,_ + (_d,,2,,_ + _d,,3,,_) = (_d,,1,,_ + _d,,2,,_) + _d,,3,,_. 
      * *Proof*:  _d,,1,,_ + (_d,,2,,_ + _d,,3,,_) means _A,,d2+d3,V1,,_(_A,,d1,V1,,_(_v_)) = _A,,d3,V1,,_(_A,,d2,V1,,_(_A,,d1,V1,,_(_v_))) = _A,,d3,V1,,_(_A,,d1+d2,V1,,_(_v_)) which means (_d,,1,,_ + _d,,2,,_) + _d,,3,,_. Therefore the two sides are equivalent, and + is associative.
      * By induction, because of associativity we can simply write _d,,1,,_ + _d,,2,,_ + ... + _d,,n,,_ (without any parenthesis).

 * *Empty delta*: A delta _d_ is an _empty delta_ if for all _v_ in *V*: _A,,d,V,,_(_v_) = _v_ (by definition). We define one such delta and call it _d,,0,,_ (_*the* empty delta_).
    * *Theorem e1*: _Uniqueness of the empty delta_: _there is exactly one delta that is an empty delta_. 
      * *Proof*: If _d,,1,,_ is an empty delta, then _A,,d1,V,,_(_v_) = _v_ for all _v_, by definition. However, _v_ = _A,,d0,V,,_(_v_) because we have already defined the empty delta _d,,0,,_. Therefore by definition _d,,0,,_ = _d,,1,,_ (totally) and they are the same delta.
    * *Theorem e2*: For every _d_: _d_ + _d,,0,,_ = _d,,0,,_ + _d_ = _d_ in the domain *V1* of _d_. 
      * *Proof*: _d_ + _d,,0,,_ means by definition _A,,d+d0,V1,,_(_v_) = _A,,d0,V1,,_(_A,,d,V1,,_(_v_)) = {by definition of _d,,0,,_} = _A,,d,V1,,_(_v_). Therefore applying _d_ + _d,,0,,_ is the same as applying d, and they are equal. The other order _d,,0,,_ + _d_ = _d_ can be proved in the same way.
    * *Theorem e3*: _d,,1,,_ + _d,,2,,_ = _d,,1,,_ + _d,,3,,_ in *V,,1,,*, if and only if: _d,,2,,_ = _d,,3,,_ in the image of _A,,d1,V1,,_. 
      * *Proof*: 
        # =>: The first equation means that for every _v_ in *V1* (for which we assume that _A,,d1,V1,,_(_v_) is in *V,,2,3,,*): _A,,d2,V2,,_(_A,,d1,V1,,_(_v_)) = _A,,d3,V3,,_(_A,,d1,V1,,_(_v_)). We can name _v,,1,,_ = _A,,d1,V1,,_(_v_), then: _A,,d2,V2,,_(_v,,1,,_) = _A,,d3,V3,,_(_v,,1,,_). By definition this implies that _d,,2,,_ = _d,,3,,_ (in the image of _A,,d1,V1,,).
        # <=: The second equation is: _A,,d2,V2,,_(_v_) = _A,,d3,V3,,_(_v_) in the image of _A,,d1,V1,,. For all _v,,1,,_ in *V1*, there exists _v,,2,,_ = _A,,d1,V1,,_(_v,,1,,_): set _v_ = _v,,2,,_ and we get the first equation.


= Axioms on deltas =
 * *Axiom 1: Negation* (reversal): for every delta _d_ there exists a delta -_d_ such that: _d_ + (-_d_) = _d,,0,,_ in the domain of _d_. -_d_ is called the *reverse* of _d_.
    * Note that by definition, the image of _d_ is the domain of _-d_.
    * *Theorem n1*: _Symmetry of reverse_: If -_d_ is the reverse of _d_, and the image of  _-d_ is the domain of _d_, then _d_ is the reverse of -_d_.
      * *Proof*: _d_ + _-d_ = _d,,0,,_  in the domain of _d_ => {adding both sides to _-d_: using the condition that the image of _-d_ is the domain of _d_  to apply theorem e3} => _-d_ + (_d_ + _-d_) = _-d_ + _d,,0,,_ = {associativity on left, and by definition commutativity with _d,,0,,_ on right} = (_-d_ + _d_) + _-d_ = _d,,0,,_ + _-d_ => {theorem e3} => _-d_ + _d_ = _d,,0,,_.
    * *Theorem n2*: _Uniqueness of reverse_: For every _d_ there exists exactly one reverse. 
      * *Proof*: If _d,,1,,_ is another reverse of _d_, then _d_ + _d,,1,,_ = _d,,0,,_ = _d_ + _-d_ => {theorem e3} => _d,,1,,_ = _-d_.


= More definitions =
 * *Atomic delta*: _d_ is an *atomic delta* if and only if there is no pair (_d,,1,,_, _d,,2,,_) such that _d,,1,,_ + _d,,2,,_ = _d_ in the domain of _d_.
 * *Common applicable delta* of a set of values, is a delta that is applicable to all values in the set.
 * *Value class*: A *value class* is a set of values with at least one common applicable delta.
    * Example: the set of all `Dict`s is a value class (because they have a common applicable delta, in fact they have several).
 * *Delta path*: A *delta path* from _v,,1,,_ to _v,,2,,_ is any ordered sequence of *atomic* deltas (_d,,1,,_, _d,,2,,_, ..., _d,,n,,_), such that _A,,dn,V1,,(A,,d(n-1),V1,,(...(A,,d1,V1,,(_v,,1,,_)))..))_ = _v,,2,,_.
   * Note that by definition there is a single delta (_d,,1,,_+_d,,2,,_+...+_d,,n,,_) that is the same as the above application of the sequence, but it is not a delta path because it is not atomic.
   * Also, there is an infinite number of arbitrary long delta paths from any value to any value, because we can always add another pair of canceling atomic deltas to the path: (_d_, -_d_).
   * *Theorem (path 1)*: _Reverse delta path theorem_: Every finite delta path from _v,,1,,_ to _v,,2,,_ has a reverse delta path from _v,,2,,_ to _v,,1,,_.
     * *Proof*: A delta path from _v,,1,,_ to _v,,2,,_ consists of a sequence of atomic deltas, {_d,,1,,_, _d,,2,,_, ..., _d,,n,,_}. We can build a delta, the sum _s,,n,,_ = (_d,,1,,_ + _d,,2,,_ + ... + _d,,n,,_), which will lead also from _v,,1,,_ to _v,,2,,_. Using axiom 1 (every delta has a reverse), this composite sum also has a reverse -_s,,n,,_. If -_s,,n,,_ is atomic, we have found a reverse delta path. If not, by definition there exists a set of deltas who's sum is -_s,,n,,_ and they are the reverse delta path.
   * *Theorem* (path 1a): Like theorem (path 1) but the reverse path is of the same length as the original path.
     * *Proof*: *TODO*
   * *Theorem* (path 1b): Like theorem (path 1) but the path is infinite.
     * *Proof*: *TODO*
 * *Length of delta path*: The length of a delta path is the number of deltas in the sequence.
 * *Delta distance*: the delta distance from _v,,1,,_ to _v,,2,,_ is the shortest length of any delta path from _v,,1,,_ to _v,,2,,_.
    * This is written: |_v,,1,,_ - _v,,2,,_|*,,D,,*. 
    * *Theorem (distance 1)*: |_v,,1,,_ - _v,,2,,_|*,,D,,* = |_v,,2,,_ - _v,,1,,_|*,,D,,*.
      * *Proof*: Using the existence of a reverse delta for every delta in the path from _v,,1,,_ to _v,,2,,_, we can always construct a reverse path of the same length. The reverse path can not be shorter, because if there is a way to cancel out deltas on the reverse path, the reverse of the same pair of deltas in the forward path could have also been canceled out.
 
 * *Conflicting deltas*: a pair of deltas is said to _*conflict* in *V1*_ (*V1* is a subset of *V*) if and only if the deltas are *not commutative* under addition, in *V1*.
   * *Theorem (conflict 1)*: _An empty delta never conflicts_.
     * *Proof*: Trivial - by definition, an empty delta is always commutative under addition with any delta.

 * *Connected values*: For a given set of deltas, *D1*, two values are connected if and only if there is a delta path from one value to the other.
   * Note: According to theorem 
 * *Delta support*: The *delta support* of *V1*, is the set of all deltas _d_ such that _d_ is applicable to at least one value in *V1*. It is equal to the union of all sets of common applicable deltas for all subsets of *V1*.